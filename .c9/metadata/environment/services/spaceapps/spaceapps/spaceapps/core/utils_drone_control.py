{"filter":false,"title":"utils_drone_control.py","tooltip":"/services/spaceapps/spaceapps/spaceapps/core/utils_drone_control.py","undoManager":{"mark":16,"position":16,"stack":[[{"start":{"row":0,"column":0},"end":{"row":118,"column":0},"action":"insert","lines":["import socket","import logging","","import droneconfig","","","class DroneControl(object):","    \"\"\"This is the base drone control app, it handles connecting to the drone","    and sending necessary commands for controlling the drone","    \"\"\"","","    def __init__(self):","        self._ip = '172.16.10.1'","        self._tcp_port = 8888","        self._udp_port = 8895","        self.is_connected = False","","    def connect(self):","        \"\"\"Kicks off the connection on the tcp and udp ports.  This must be run","        before attempting to send control commands to the quadcopter.","        \"\"\"","        self.connect_tcp()","        self.connect_udp()","","    def connect_tcp(self):","        \"\"\"This is just an initial handshake between the computer and the drone.the","        The actual flight data is send over the udp connection.","        \"\"\"","        logging.info(\"Starting Handshake...\")","        self.tcp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)","        self.tcp_socket.connect((self._ip, self._tcp_port))","        self.tcp_socket.send(droneconfig.HANDSHAKE_DATA)","        logging.info(\"Handshake done!\")","","    def connect_udp(self):","        \"\"\"Connects the udp port that the drone flight commands are sent over.","        \"\"\"","        logging.info(\"Starting drone...\")","        self.udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)","        self.udp_socket.connect((self._ip, self._udp_port))","        droneCmd = droneconfig.START_DRONE_DATA[:]","        self.udp_socket.send(droneCmd)","        logging.info(\"Drone started!\")","","    def checksum(self, data):","        \"\"\"The flight data has to be passed through a checksum before it will run.","        Not sure why this is necessary as udp automatically ensures a checksum.","","        Returns:","            the 8 bit xor checksum of the data","        \"\"\"","        return_data = (data[1] ^ data[2] ^ data[3] ^ data[4] ^ data[5]) & 0xFF","        return return_data","","    def disconnect(self):","        \"\"\"This should be run if the user wishes to disconnect the drone from the program.","        If this program is killed, however, it should automatically disconnect.","        \"\"\"","        logging.info(\"Disconnecting...\")","        self.udp_socket.close()","        self.tcp_socket.close()","        logging.info(\"Disconnected!\")","","    def cmd(self, r=127, p=127, t=15, y=127):","        \"\"\"This is the flight command controls.","","        Args:","            r (int): 0-255 for the roll of the drone, 127 is the middle","            p (int): 0-255 for the pitch of the drone, 127 is the middle","            t (int): 0-255 for the throttle of the drone, 0 is no throttle","            y (int): 0-255 for the yaw of the drone, 127 is middle","        \"\"\"","        droneCmd = droneconfig.FLY_DRONE_DATA[:]","        droneCmd[1] = r","        droneCmd[2] = p","        droneCmd[3] = t","        droneCmd[4] = y","        droneCmd[6] = self.checksum(droneCmd)","        self.udp_socket.send(droneCmd)","","    def take_off(self):","        \"\"\"Sends the takeoff command for the drone","        \"\"\"","        logging.info(\"taking off\")","        takeOffCmd = droneconfig.FLY_DRONE_DATA","        # We send 16 packets as this is udp and there is the possibility of","        # dropping them","        for i in xrange(16):","            self.udp_socket.send(takeOffCmd)","        logging.info(\"done taking off\")","","    def land(self):","        \"\"\"Send the land command for the drone","        \"\"\"","        landCmd = droneconfig.LAND_DRONE_DATA","        # We send 16 packets as this is udp and there is the possibility of","        # dropping them","        for i in xrange(16):","            self.udp_socket.send(landCmd)","","    def stop(self):","        \"\"\"This is a hard stop for the drone.  If it is flying and this is called,","        it will fall out of the air.","        \"\"\"","        for i in xrange(16):","            self.udp_socket.send(droneconfig.START_DRONE_DATA)","","","if __name__ == \"__main__\":","    drone = DroneControl()","    drone.connect()","","    for i in range(100):","        drone.cmd(t=100)","","    drone.land()","    drone.stop()","    drone.disconnect()",""],"id":34}],[{"start":{"row":3,"column":7},"end":{"row":3,"column":18},"action":"remove","lines":["droneconfig"],"id":35},{"start":{"row":3,"column":6},"end":{"row":3,"column":7},"action":"remove","lines":[" "]},{"start":{"row":3,"column":5},"end":{"row":3,"column":6},"action":"remove","lines":["t"]},{"start":{"row":3,"column":4},"end":{"row":3,"column":5},"action":"remove","lines":["r"]},{"start":{"row":3,"column":3},"end":{"row":3,"column":4},"action":"remove","lines":["o"]},{"start":{"row":3,"column":2},"end":{"row":3,"column":3},"action":"remove","lines":["p"]},{"start":{"row":3,"column":1},"end":{"row":3,"column":2},"action":"remove","lines":["m"]},{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"remove","lines":["i"]}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"insert","lines":["f"],"id":36},{"start":{"row":3,"column":1},"end":{"row":3,"column":2},"action":"insert","lines":["r"]},{"start":{"row":3,"column":2},"end":{"row":3,"column":3},"action":"insert","lines":["o"]},{"start":{"row":3,"column":3},"end":{"row":3,"column":4},"action":"insert","lines":["m"]}],[{"start":{"row":3,"column":4},"end":{"row":3,"column":5},"action":"insert","lines":[" "],"id":37},{"start":{"row":3,"column":5},"end":{"row":3,"column":6},"action":"insert","lines":["s"]},{"start":{"row":3,"column":6},"end":{"row":3,"column":7},"action":"insert","lines":["p"]},{"start":{"row":3,"column":7},"end":{"row":3,"column":8},"action":"insert","lines":["a"]},{"start":{"row":3,"column":8},"end":{"row":3,"column":9},"action":"insert","lines":["c"]},{"start":{"row":3,"column":9},"end":{"row":3,"column":10},"action":"insert","lines":["e"]},{"start":{"row":3,"column":10},"end":{"row":3,"column":11},"action":"insert","lines":["a"]},{"start":{"row":3,"column":11},"end":{"row":3,"column":12},"action":"insert","lines":["p"]},{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":["p"]},{"start":{"row":3,"column":13},"end":{"row":3,"column":14},"action":"insert","lines":["s"]}],[{"start":{"row":3,"column":14},"end":{"row":3,"column":15},"action":"insert","lines":["."],"id":38},{"start":{"row":3,"column":15},"end":{"row":3,"column":16},"action":"insert","lines":["c"]},{"start":{"row":3,"column":16},"end":{"row":3,"column":17},"action":"insert","lines":["o"]},{"start":{"row":3,"column":17},"end":{"row":3,"column":18},"action":"insert","lines":["r"]},{"start":{"row":3,"column":18},"end":{"row":3,"column":19},"action":"insert","lines":["e"]},{"start":{"row":3,"column":19},"end":{"row":3,"column":20},"action":"insert","lines":["."]}],[{"start":{"row":3,"column":20},"end":{"row":3,"column":21},"action":"insert","lines":["u"],"id":39},{"start":{"row":3,"column":21},"end":{"row":3,"column":22},"action":"insert","lines":["t"]},{"start":{"row":3,"column":22},"end":{"row":3,"column":23},"action":"insert","lines":["i"]},{"start":{"row":3,"column":23},"end":{"row":3,"column":24},"action":"insert","lines":["l"]},{"start":{"row":3,"column":24},"end":{"row":3,"column":25},"action":"insert","lines":["s"]}],[{"start":{"row":3,"column":20},"end":{"row":3,"column":25},"action":"remove","lines":["utils"],"id":40},{"start":{"row":3,"column":20},"end":{"row":3,"column":38},"action":"insert","lines":["utils_drone_config"]}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":4},"action":"remove","lines":["from"],"id":41},{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"insert","lines":["i"]},{"start":{"row":3,"column":1},"end":{"row":3,"column":2},"action":"insert","lines":["m"]},{"start":{"row":3,"column":2},"end":{"row":3,"column":3},"action":"insert","lines":["p"]},{"start":{"row":3,"column":3},"end":{"row":3,"column":4},"action":"insert","lines":["o"]},{"start":{"row":3,"column":4},"end":{"row":3,"column":5},"action":"insert","lines":["r"]},{"start":{"row":3,"column":5},"end":{"row":3,"column":6},"action":"insert","lines":["t"]}],[{"start":{"row":3,"column":6},"end":{"row":3,"column":7},"action":"insert","lines":[" "],"id":42}],[{"start":{"row":3,"column":6},"end":{"row":3,"column":7},"action":"remove","lines":[" "],"id":43}],[{"start":{"row":3,"column":40},"end":{"row":3,"column":41},"action":"insert","lines":[" "],"id":44},{"start":{"row":3,"column":41},"end":{"row":3,"column":42},"action":"insert","lines":["a"]},{"start":{"row":3,"column":42},"end":{"row":3,"column":43},"action":"insert","lines":["s"]}],[{"start":{"row":3,"column":43},"end":{"row":3,"column":44},"action":"insert","lines":[" "],"id":45},{"start":{"row":3,"column":44},"end":{"row":3,"column":45},"action":"insert","lines":["d"]},{"start":{"row":3,"column":45},"end":{"row":3,"column":46},"action":"insert","lines":["r"]},{"start":{"row":3,"column":46},"end":{"row":3,"column":47},"action":"insert","lines":["o"]},{"start":{"row":3,"column":47},"end":{"row":3,"column":48},"action":"insert","lines":["n"]},{"start":{"row":3,"column":48},"end":{"row":3,"column":49},"action":"insert","lines":["e"]},{"start":{"row":3,"column":49},"end":{"row":3,"column":50},"action":"insert","lines":["c"]},{"start":{"row":3,"column":50},"end":{"row":3,"column":51},"action":"insert","lines":["o"]}],[{"start":{"row":3,"column":51},"end":{"row":3,"column":52},"action":"insert","lines":["n"],"id":46},{"start":{"row":3,"column":52},"end":{"row":3,"column":53},"action":"insert","lines":["f"]},{"start":{"row":3,"column":53},"end":{"row":3,"column":54},"action":"insert","lines":["i"]},{"start":{"row":3,"column":54},"end":{"row":3,"column":55},"action":"insert","lines":["g"]}],[{"start":{"row":87,"column":17},"end":{"row":87,"column":23},"action":"remove","lines":["xrange"],"id":47},{"start":{"row":87,"column":17},"end":{"row":87,"column":18},"action":"insert","lines":["r"]},{"start":{"row":87,"column":18},"end":{"row":87,"column":19},"action":"insert","lines":["a"]},{"start":{"row":87,"column":19},"end":{"row":87,"column":20},"action":"insert","lines":["n"]},{"start":{"row":87,"column":20},"end":{"row":87,"column":21},"action":"insert","lines":["g"]},{"start":{"row":87,"column":21},"end":{"row":87,"column":22},"action":"insert","lines":["e"]}],[{"start":{"row":97,"column":17},"end":{"row":97,"column":23},"action":"remove","lines":["xrange"],"id":48},{"start":{"row":97,"column":17},"end":{"row":97,"column":18},"action":"insert","lines":["r"]}],[{"start":{"row":97,"column":18},"end":{"row":97,"column":19},"action":"insert","lines":["a"],"id":49},{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"insert","lines":["n"]},{"start":{"row":97,"column":20},"end":{"row":97,"column":21},"action":"insert","lines":["g"]},{"start":{"row":97,"column":21},"end":{"row":97,"column":22},"action":"insert","lines":["e"]}],[{"start":{"row":104,"column":17},"end":{"row":104,"column":23},"action":"remove","lines":["xrange"],"id":50},{"start":{"row":104,"column":17},"end":{"row":104,"column":18},"action":"insert","lines":["r"]},{"start":{"row":104,"column":18},"end":{"row":104,"column":19},"action":"insert","lines":["a"]},{"start":{"row":104,"column":19},"end":{"row":104,"column":20},"action":"insert","lines":["n"]},{"start":{"row":104,"column":20},"end":{"row":104,"column":21},"action":"insert","lines":["g"]},{"start":{"row":104,"column":21},"end":{"row":104,"column":22},"action":"insert","lines":["e"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":89,"column":39},"end":{"row":89,"column":39},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1571545602875,"hash":"3d111019d9182a447493ba834d795b936f8a3644"}